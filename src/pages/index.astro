---
// src/pages/index.astro
// New homepage with clean hero and list-based projects
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import ProjectListItem from '../components/ProjectListItem.astro';
import { readdirSync, readFileSync } from 'fs';
import { join } from 'path';

// Read all project files from the data directory
const projectsDir = join(process.cwd(), 'src', 'data', 'projects');
const projectFiles = readdirSync(projectsDir).filter(file => file.endsWith('.json'));

// Load and parse all projects
const allProjects = projectFiles.map(file => {
  const content = readFileSync(join(projectsDir, file), 'utf-8');
  return JSON.parse(content);
});

// Filter for featured and published projects, limit to 5
const projects = allProjects
  .filter(project => project.featured && project.status === 'published')
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 5); // Cap at 5 projects for homepage
---

<Layout title="Nate Wilkens - Portfolio">
  
  <!-- Hero Section -->
  <Hero />

  <!-- Projects Section -->
  <section id="projects">
    <div class="section-header">
      <span class="section-marker">&gt;&gt;SELECTED WORK</span>
      <span class="section-years">20-25&lt;&lt;</span>
    </div>
    
    <div class="project-list">
      {projects.map(project => (
        <ProjectListItem 
          client={project.client} 
          title={project.title} 
          tags={project.tags}
          slug={project.slug}
        />
      ))}
    </div>
  </section>

</Layout>

<style>
  #projects {
    background: var(--red);
    padding: 0 5vw 120px; /* Minimal bottom padding for fixed footer */
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  
  /* Section Header */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 20px; /* Tighter spacing */
    padding-bottom: 12px; /* Tighter spacing */
    border-bottom: 2px solid var(--black);
    width: 100%;
  }
  
  .section-marker,
  .section-years {
    font-family: 'Geist Mono', monospace;
    font-size: clamp(0.875rem, 1.5vw, 1.25rem);
    letter-spacing: 0.05em;
    font-weight: 500;
    color: var(--black);
  }
  
  /* Project List */
  .project-list {
    width: 100%;
    margin: 0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    #projects {
      padding: 0 5vw 70px;
    }
    
    .section-header {
      margin-bottom: 32px;
      padding-bottom: 12px;
    }

    .section-marker,
    .section-years {
      font-size: clamp(0.75rem, 3vw, 1rem);
    }
  }
</style>